<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CMHC Policy Assistant</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#08090e;--card:#10131c;--card-border:#1a1f2e;
--gold:#d4a853;--emerald:#10b981;--gold-dim:rgba(212,168,83,.15);--emerald-dim:rgba(16,185,129,.15);
--text:#e8eaf0;--text2:#6b7280;--text3:#3a3f4b;
--font:'Inter',system-ui,sans-serif;--mono:'JetBrains Mono',monospace;
--grad:linear-gradient(135deg,var(--gold),var(--emerald));
}
html,body{height:100%;font-family:var(--font);background:var(--bg);color:var(--text);overflow:hidden;-webkit-font-smoothing:antialiased}
::selection{background:rgba(212,168,83,.3)}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(212,168,83,.2);border-radius:5px}

/* ===== LOGIN SCREEN ===== */
#login-screen{position:fixed;inset:0;z-index:1000;display:flex;transition:opacity .8s ease,visibility .8s}
#login-screen.hidden{opacity:0;visibility:hidden;pointer-events:none}
.login-left{width:60%;background:var(--bg);position:relative;overflow:hidden;display:flex;flex-direction:column;justify-content:center;padding:80px;transition:transform .8s cubic-bezier(.4,0,.2,1)}
#login-screen.hidden .login-left{transform:translateX(-100%)}
.login-right{width:40%;background:#fafafa;display:flex;align-items:center;justify-content:center;padding:60px;transition:transform .8s cubic-bezier(.4,0,.2,1)}
#login-screen.hidden .login-right{transform:translateX(100%)}

/* Left panel content */
.login-brand{font-size:14px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--gold);margin-bottom:40px}
.login-headline{font-size:clamp(36px,5vw,64px);font-weight:800;letter-spacing:-1.5px;line-height:1.05;margin-bottom:24px}
.login-headline span{background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.login-sub{font-size:18px;color:var(--text2);line-height:1.6;max-width:500px}

/* Floating stats */
.floating-stats{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.float-stat{position:absolute;font-family:var(--mono);font-weight:600;opacity:0;animation:floatUp 8s linear infinite}
.float-stat:nth-child(1){left:10%;animation-delay:0s;color:rgba(212,168,83,.12);font-size:28px}
.float-stat:nth-child(2){left:30%;animation-delay:2s;color:rgba(16,185,129,.1);font-size:22px}
.float-stat:nth-child(3){left:55%;animation-delay:4s;color:rgba(212,168,83,.08);font-size:32px}
.float-stat:nth-child(4){left:75%;animation-delay:1s;color:rgba(16,185,129,.12);font-size:20px}
.float-stat:nth-child(5){left:45%;animation-delay:6s;color:rgba(212,168,83,.1);font-size:26px}
.float-stat:nth-child(6){left:85%;animation-delay:3s;color:rgba(16,185,129,.08);font-size:24px}
@keyframes floatUp{0%{transform:translateY(100vh);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(-100px);opacity:0}}

/* Gradient mesh */
.login-mesh{position:absolute;inset:0;pointer-events:none}
.login-mesh::before{content:'';position:absolute;width:600px;height:600px;border-radius:50%;background:radial-gradient(circle,rgba(212,168,83,.06),transparent 70%);top:-100px;right:-200px;animation:meshPulse 8s ease-in-out infinite}
.login-mesh::after{content:'';position:absolute;width:500px;height:500px;border-radius:50%;background:radial-gradient(circle,rgba(16,185,129,.05),transparent 70%);bottom:-100px;left:-100px;animation:meshPulse 10s ease-in-out infinite 3s}
@keyframes meshPulse{0%,100%{transform:scale(1);opacity:.6}50%{transform:scale(1.2);opacity:1}}

/* Right panel login form */
.login-form-wrap{width:100%;max-width:360px}
.login-form-title{font-size:24px;font-weight:700;color:#1a1a1a;letter-spacing:-.5px;margin-bottom:8px}
.login-form-sub{font-size:14px;color:#888;margin-bottom:32px}
.login-form-wrap label{display:block;font-size:12px;font-weight:600;color:#666;letter-spacing:.5px;text-transform:uppercase;margin-bottom:8px}
.login-input{width:100%;padding:14px 16px;border:2px solid #e5e5e5;border-radius:12px;font-size:16px;font-family:var(--font);background:#fff;color:#1a1a1a;outline:none;transition:border-color .2s}
.login-input:focus{border-color:var(--gold)}
.login-btn{width:100%;padding:14px;border:none;border-radius:12px;font-size:15px;font-weight:600;font-family:var(--font);cursor:pointer;margin-top:16px;background:var(--bg);color:#fff;transition:all .2s}
.login-btn:hover{transform:translateY(-1px);box-shadow:0 8px 30px rgba(0,0,0,.3)}
.login-btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
.login-error{color:#dc2626;font-size:13px;margin-top:12px;min-height:20px}
.login-footer{margin-top:40px;font-size:12px;color:#aaa;text-align:center}

/* ===== MAIN APP ===== */
#app{display:none;height:100vh;flex-direction:row}
#app.active{display:flex}

/* Nav sidebar */
.nav-sidebar{width:60px;background:var(--card);border-right:1px solid var(--card-border);display:flex;flex-direction:column;align-items:center;padding:16px 0;transition:width .3s ease;flex-shrink:0;z-index:50}
.nav-sidebar.expanded{width:240px}
.nav-logo{width:36px;height:36px;border-radius:10px;background:var(--grad);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:14px;color:#08090e;margin-bottom:24px;flex-shrink:0}
.nav-item{width:100%;padding:12px 0;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text2);transition:all .2s;position:relative;border-radius:0}
.nav-sidebar.expanded .nav-item{padding:12px 20px;justify-content:flex-start;gap:12px}
.nav-item:hover{color:var(--text)}
.nav-item.active{color:var(--gold)}
.nav-item.active::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:3px;height:24px;background:var(--gold);border-radius:0 3px 3px 0}
.nav-item svg{width:20px;height:20px;flex-shrink:0}
.nav-label{font-size:13px;font-weight:500;white-space:nowrap;overflow:hidden;display:none}
.nav-sidebar.expanded .nav-label{display:block}
.nav-toggle{margin-top:auto;cursor:pointer;color:var(--text3);padding:12px;transition:color .2s}
.nav-toggle:hover{color:var(--text2)}

/* Main content area */
.main-area{flex:1;display:flex;flex-direction:column;overflow:hidden;position:relative}

/* Top bar */
.top-bar{height:52px;border-bottom:1px solid var(--card-border);display:flex;align-items:center;padding:0 24px;gap:16px;background:rgba(16,19,28,.8);backdrop-filter:blur(20px);flex-shrink:0;z-index:10}
.status-indicator{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--text2)}
.status-dot{width:7px;height:7px;border-radius:50%;background:var(--emerald);box-shadow:0 0 8px rgba(16,185,129,.5);animation:statusPulse 3s ease-in-out infinite}
@keyframes statusPulse{0%,100%{opacity:1}50%{opacity:.5}}
.status-text span{font-family:var(--mono);color:var(--emerald)}
.top-bar-spacer{flex:1}
.top-bar-time{font-family:var(--mono);font-size:12px;color:var(--text3)}

/* Content panels */
.content-panel{flex:1;overflow:hidden;display:none;flex-direction:column}
.content-panel.active{display:flex}

/* ===== CHAT PANEL ===== */
/* Command bar input */
.command-bar-wrap{padding:24px 24px 0;flex-shrink:0}
.command-bar{position:relative;max-width:720px;margin:0 auto}
.command-input{width:100%;padding:16px 60px 16px 20px;border:1px solid var(--card-border);border-radius:14px;font-size:15px;font-family:var(--font);background:rgba(16,19,28,.6);backdrop-filter:blur(20px);color:var(--text);outline:none;transition:all .3s}
.command-input:focus{border-color:rgba(212,168,83,.4);box-shadow:0 0 0 3px rgba(212,168,83,.08)}
.command-input::placeholder{color:var(--text3)}
.command-hint{position:absolute;right:16px;top:50%;transform:translateY(-50%);font-size:11px;font-family:var(--mono);color:var(--text3);pointer-events:none;transition:opacity .2s}
.command-input:focus~.command-hint{opacity:0}
.command-send{position:absolute;right:8px;top:50%;transform:translateY(-50%);width:36px;height:36px;border:none;border-radius:10px;background:var(--grad);color:#08090e;cursor:pointer;display:none;align-items:center;justify-content:center;font-size:18px}
.command-input:not(:placeholder-shown)~.command-hint{opacity:0}
.command-input:not(:placeholder-shown)~.command-send{display:flex}

/* Progress bar */
.progress-bar{height:2px;background:transparent;position:relative;flex-shrink:0}
.progress-bar.loading{background:var(--card-border)}
.progress-bar.loading::after{content:'';position:absolute;left:0;top:0;height:100%;width:30%;background:var(--grad);animation:progressSlide 1.5s ease-in-out infinite}
@keyframes progressSlide{0%{left:-30%;width:30%}50%{width:50%}100%{left:100%;width:30%}}

/* Chat area */
.chat-area{flex:1;overflow-y:auto;padding:24px}

/* Welcome dashboard */
.welcome{max-width:720px;margin:0 auto}
.stat-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
.stat-card{background:var(--card);border:1px solid var(--card-border);border-radius:14px;padding:20px;position:relative;overflow:hidden;animation:cardFloat 6s ease-in-out infinite}
.stat-card:nth-child(2){animation-delay:2s}.stat-card:nth-child(3){animation-delay:4s}
@keyframes cardFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--grad)}
.stat-card-icon{font-size:24px;margin-bottom:8px}
.stat-card-value{font-family:var(--mono);font-size:28px;font-weight:700;letter-spacing:-.5px;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.stat-card-label{font-size:12px;color:var(--text2);margin-top:4px;font-weight:500}

.section-title{font-size:11px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-bottom:14px}

.suggest-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:24px}
.suggest-card{background:var(--card);border:1px solid var(--card-border);border-radius:12px;padding:16px;cursor:pointer;transition:all .25s;position:relative;overflow:hidden}
.suggest-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--grad);opacity:0;transition:opacity .25s}
.suggest-card:hover{border-color:rgba(212,168,83,.3);transform:translateY(-3px);box-shadow:0 8px 30px rgba(212,168,83,.08)}
.suggest-card:hover::before{opacity:1}
.suggest-card-icon{font-size:20px;margin-bottom:8px;transition:transform .25s}
.suggest-card:hover .suggest-card-icon{transform:scale(1.15)}
.suggest-card-title{font-size:13px;font-weight:600;letter-spacing:-.3px;margin-bottom:4px}
.suggest-card-desc{font-size:11px;color:var(--text2);line-height:1.4}

.updates-banner{background:var(--card);border:1px solid var(--card-border);border-radius:12px;padding:14px 18px;display:flex;align-items:center;gap:12px;font-size:13px}
.updates-banner::before{content:'';width:3px;height:24px;background:var(--grad);border-radius:3px;flex-shrink:0}
.updates-banner .label{color:var(--gold);font-weight:600;font-size:11px;letter-spacing:.5px;text-transform:uppercase}
.updates-banner .desc{color:var(--text2)}

/* Messages */
.messages{max-width:720px;margin:0 auto;display:flex;flex-direction:column;gap:20px}
.msg{animation:msgIn .4s ease}
@keyframes msgIn{from{opacity:0;transform:translateX(-12px)}to{opacity:1;transform:translateX(0)}}
.msg.user{animation-name:msgInUser}
@keyframes msgInUser{from{opacity:0;transform:translateX(12px)}to{opacity:1;transform:translateX(0)}}

.msg.user .msg-content{text-align:right;padding:8px 16px 8px 0;border-right:3px solid var(--gold);margin-left:auto;max-width:80%;color:var(--text)}
.msg.user .msg-label{text-align:right;font-size:10px;color:var(--text3);margin-bottom:4px;font-weight:600;letter-spacing:.5px;text-transform:uppercase}

.msg.bot .msg-card{background:var(--card);border:1px solid var(--card-border);border-radius:14px;overflow:hidden}
.msg.bot .msg-card-bar{height:3px;background:var(--grad)}
.msg.bot .msg-card-body{padding:20px 24px}
.msg.bot .msg-card-body h1,.msg.bot .msg-card-body h2,.msg.bot .msg-card-body h3{letter-spacing:-.5px;margin:16px 0 8px;font-weight:700}
.msg.bot .msg-card-body h1{font-size:18px}.msg.bot .msg-card-body h2{font-size:16px}.msg.bot .msg-card-body h3{font-size:14px;color:var(--gold)}
.msg.bot .msg-card-body p{margin:8px 0;line-height:1.7;color:#c8ccd4;font-size:14px}
.msg.bot .msg-card-body ul,.msg.bot .msg-card-body ol{margin:8px 0 8px 20px;line-height:1.8;color:#c8ccd4;font-size:14px}
.msg.bot .msg-card-body strong{color:var(--text);font-weight:600}
.msg.bot .msg-card-body code{font-family:var(--mono);font-size:13px;background:rgba(212,168,83,.1);color:var(--gold);padding:2px 6px;border-radius:4px}
.msg.bot .msg-card-body a{color:var(--gold);text-decoration:none;border-bottom:1px solid rgba(212,168,83,.3)}
.msg.bot .msg-card-body a:hover{border-color:var(--gold)}

/* Tables */
.msg.bot .msg-card-body table{width:100%;border-collapse:collapse;margin:12px 0;border-radius:10px;overflow:hidden;font-size:13px}
.msg.bot .msg-card-body thead{background:linear-gradient(135deg,rgba(212,168,83,.15),rgba(16,185,129,.15))}
.msg.bot .msg-card-body th{padding:10px 14px;text-align:left;font-weight:600;font-size:11px;letter-spacing:.5px;text-transform:uppercase;color:var(--gold);border-bottom:1px solid var(--card-border)}
.msg.bot .msg-card-body td{padding:10px 14px;border-bottom:1px solid rgba(26,31,46,.5);font-family:var(--mono);font-size:12px}
.msg.bot .msg-card-body tbody tr:nth-child(even){background:rgba(16,19,28,.5)}
.msg.bot .msg-card-body tbody tr:hover{background:rgba(212,168,83,.05)}

/* Numbers in mono */
.mono{font-family:var(--mono)}

/* Message toolbar */
.msg-toolbar{display:flex;gap:2px;padding:8px 16px;border-top:1px solid var(--card-border)}
.msg-toolbar button{background:none;border:none;color:var(--text3);font-size:12px;font-family:var(--font);cursor:pointer;padding:6px 10px;border-radius:6px;display:flex;align-items:center;gap:5px;transition:all .2s}
.msg-toolbar button:hover{color:var(--text);background:rgba(255,255,255,.05)}
.msg-toolbar button.active{color:var(--gold)}

/* Sources */
.msg-sources{padding:8px 16px 12px;display:flex;flex-wrap:wrap;gap:6px}
.source-pill{font-size:11px;padding:4px 10px;border-radius:20px;background:rgba(212,168,83,.08);color:var(--gold);border:1px solid rgba(212,168,83,.15);cursor:default;font-weight:500}

/* ===== QUICK REFERENCE PANEL ===== */
.ref-panel{padding:24px;overflow-y:auto}
.ref-panel h2{font-size:20px;font-weight:700;letter-spacing:-.5px;margin-bottom:20px}
.ref-section{background:var(--card);border:1px solid var(--card-border);border-radius:14px;margin-bottom:16px;overflow:hidden}
.ref-section::before{content:'';display:block;height:3px;background:var(--grad)}
.ref-section h3{padding:16px 20px 8px;font-size:14px;font-weight:700;color:var(--gold);letter-spacing:-.3px}
.ref-section table{width:100%;font-size:12px;border-collapse:collapse}
.ref-section th{padding:8px 20px;text-align:left;font-weight:600;font-size:10px;letter-spacing:.5px;text-transform:uppercase;color:var(--text2);background:rgba(16,19,28,.5);border-bottom:1px solid var(--card-border)}
.ref-section td{padding:8px 20px;border-bottom:1px solid rgba(26,31,46,.3);font-family:var(--mono);font-size:12px;color:#c8ccd4}
.ref-section tbody tr:hover{background:rgba(212,168,83,.03)}

/* ===== SAVED PANEL ===== */
.saved-panel{padding:24px;overflow-y:auto}
.saved-panel h2{font-size:20px;font-weight:700;letter-spacing:-.5px;margin-bottom:20px}
.saved-empty{text-align:center;padding:60px 20px;color:var(--text3)}
.saved-empty svg{width:48px;height:48px;margin-bottom:16px;opacity:.3}
.saved-item{background:var(--card);border:1px solid var(--card-border);border-radius:12px;padding:16px;margin-bottom:12px;cursor:pointer;transition:border-color .2s}
.saved-item:hover{border-color:rgba(212,168,83,.3)}
.saved-item .q{font-size:13px;font-weight:600;margin-bottom:6px}
.saved-item .preview{font-size:12px;color:var(--text2);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.saved-item .time{font-size:10px;color:var(--text3);margin-top:8px;font-family:var(--mono)}
.saved-remove{float:right;background:none;border:none;color:var(--text3);cursor:pointer;font-size:16px;padding:0 4px}
.saved-remove:hover{color:#ef4444}

/* Responsive */
@media(max-width:768px){
.login-left{display:none}.login-right{width:100%}
.stat-cards,.suggest-grid{grid-template-columns:1fr 1fr}
.nav-sidebar{width:50px}.nav-sidebar.expanded{width:200px}
.command-bar-wrap,.chat-area{padding:16px}
}
@media(max-width:480px){
.stat-cards,.suggest-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="login-screen">
<div class="login-left">
<div class="login-mesh"></div>
<div class="floating-stats">
<div class="float-stat">12,500+ policies</div>
<div class="float-stat">$2.8B insured</div>
<div class="float-stat">95% LTV</div>
<div class="float-stat">18 documents</div>
<div class="float-stat">$55B budget</div>
<div class="float-stat">5+ units</div>
</div>
<div style="position:relative;z-index:1">
<div class="login-brand">CMHC Policy Assistant</div>
<h1 class="login-headline">Instant answers.<br><span>Smarter decisions.</span></h1>
<p class="login-sub">AI powered intelligence across CMHC multi unit mortgage insurance policies, underwriting guidelines, and program parameters.</p>
</div>
</div>
<div class="login-right">
<div class="login-form-wrap">
<h2 class="login-form-title">Welcome back</h2>
<p class="login-form-sub">Enter your access code to continue</p>
<form id="login-form">
<label>Access Code</label>
<input type="password" class="login-input" id="login-password" placeholder="Enter password" autocomplete="current-password" autofocus>
<button type="submit" class="login-btn" id="login-btn">Sign In</button>
<div class="login-error" id="login-error"></div>
</form>
<div class="login-footer">Protected system &bull; Authorized access only</div>
</div>
</div>
</div>

<!-- MAIN APP -->
<div id="app">
<!-- Nav sidebar -->
<nav class="nav-sidebar" id="nav-sidebar">
<div class="nav-logo">CA</div>
<div class="nav-item active" data-panel="chat" onclick="switchPanel('chat')">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
<span class="nav-label">Chat</span>
</div>
<div class="nav-item" data-panel="reference" onclick="switchPanel('reference')">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg>
<span class="nav-label">Quick Reference</span>
</div>
<div class="nav-item" data-panel="saved" onclick="switchPanel('saved')">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
<span class="nav-label">Saved</span>
</div>
<div class="nav-toggle" onclick="toggleNav()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/></svg>
</div>
</nav>

<!-- Main area -->
<div class="main-area">
<!-- Top bar -->
<div class="top-bar">
<div class="status-indicator">
<div class="status-dot"></div>
<div class="status-text">AI Online &bull; <span>18</span> documents &bull; Updated Feb 2025</div>
</div>
<div class="top-bar-spacer"></div>
<div class="top-bar-time" id="top-time"></div>
</div>

<!-- Chat panel -->
<div class="content-panel active" id="panel-chat">
<div class="command-bar-wrap">
<div class="command-bar">
<input type="text" class="command-input" id="chat-input" placeholder="Ask anything about CMHC policies..." autocomplete="off">
<span class="command-hint">‚åòK</span>
<button class="command-send" id="send-btn" onclick="sendMessage()">‚Üí</button>
</div>
</div>
<div class="progress-bar" id="progress-bar"></div>
<div class="chat-area" id="chat-area">
<div class="welcome" id="welcome">
<div class="stat-cards">
<div class="stat-card"><div class="stat-card-icon">üè¢</div><div class="stat-card-value" data-target="5">0</div><div class="stat-card-label">Minimum units for eligibility</div></div>
<div class="stat-card"><div class="stat-card-icon">üìä</div><div class="stat-card-value" data-target="95" data-suffix="%">0</div><div class="stat-card-label">Max LTV with MLI Select</div></div>
<div class="stat-card"><div class="stat-card-icon">üí∞</div><div class="stat-card-value" data-prefix="$" data-target="55" data-suffix="B">0</div><div class="stat-card-label">ACLP annual budget</div></div>
</div>
<div class="section-title">Explore Topics</div>
<div class="suggest-grid">
<div class="suggest-card" onclick="askSuggestion(this)"><div class="suggest-card-icon">üìã</div><div class="suggest-card-title">Eligibility Criteria</div><div class="suggest-card-desc">Property types, unit counts, and borrower requirements</div></div>
<div class="suggest-card" onclick="askSuggestion(this)"><div class="suggest-card-icon">üî¢</div><div class="suggest-card-title">Premium Rates</div><div class="suggest-card-desc">LTV tiers, premium calculations, and surcharges</div></div>
<div class="suggest-card" onclick="askSuggestion(this)"><div class="suggest-card-icon">üèóÔ∏è</div><div class="suggest-card-title">ACLP Program</div><div class="suggest-card-desc">Affordable housing construction loan parameters</div></div>
<div class="suggest-card" onclick="askSuggestion(this)"><div class="suggest-card-icon">üìê</div><div class="suggest-card-title">LTV &amp; DSC Ratios</div><div class="suggest-card-desc">Loan to value and debt service coverage rules</div></div>
<div class="suggest-card" onclick="askSuggestion(this)"><div class="suggest-card-icon">‚ö°</div><div class="suggest-card-title">MLI Select</div><div class="suggest-card-desc">Premium reductions for social and climate outcomes</div></div>
<div class="suggest-card" onclick="askSuggestion(this)"><div class="suggest-card-icon">üìÑ</div><div class="suggest-card-title">Recent Updates</div><div class="suggest-card-desc">Advice 263, 264 and 2025 policy changes</div></div>
</div>
<div class="updates-banner"><div><div class="label">Latest Update</div><div class="desc">Refreshed with 2025 policy changes including Advice 263 &amp; 264</div></div></div>
</div>
<div class="messages" id="messages" style="display:none"></div>
</div>
</div>

<!-- Reference panel -->
<div class="content-panel" id="panel-reference">
<div class="ref-panel">
<h2>Quick Reference</h2>
<div class="ref-section">
<h3>Standard Premium Rates (MLI)</h3>
<table><thead><tr><th>LTV Range</th><th>Premium Rate</th><th>With MLI Select</th></tr></thead>
<tbody>
<tr><td>Up to 65%</td><td>1.50%</td><td>1.25%</td></tr>
<tr><td>65.01% ‚Äì 75%</td><td>2.00%</td><td>1.75%</td></tr>
<tr><td>75.01% ‚Äì 80%</td><td>2.50%</td><td>2.25%</td></tr>
<tr><td>80.01% ‚Äì 85%</td><td>3.10%</td><td>2.85%</td></tr>
<tr><td>85.01% ‚Äì 95%</td><td>N/A</td><td>4.00%</td></tr>
</tbody></table>
</div>
<div class="ref-section">
<h3>Minimum DSC Ratios</h3>
<table><thead><tr><th>Scenario</th><th>Min DSC</th></tr></thead>
<tbody>
<tr><td>Standard MLI</td><td>1.10</td></tr>
<tr><td>MLI Select</td><td>1.00</td></tr>
<tr><td>ACLP</td><td>1.00</td></tr>
</tbody></table>
</div>
<div class="ref-section">
<h3>Maximum Amortization</h3>
<table><thead><tr><th>Program</th><th>Max Period</th></tr></thead>
<tbody>
<tr><td>Standard MLI</td><td>40 years</td></tr>
<tr><td>MLI Select</td><td>50 years</td></tr>
<tr><td>ACLP</td><td>50 years</td></tr>
</tbody></table>
</div>
<div class="ref-section">
<h3>Key Thresholds</h3>
<table><thead><tr><th>Parameter</th><th>Value</th></tr></thead>
<tbody>
<tr><td>Minimum units</td><td>5+</td></tr>
<tr><td>Max LTV (standard)</td><td>85%</td></tr>
<tr><td>Max LTV (MLI Select)</td><td>95%</td></tr>
<tr><td>ACLP annual budget</td><td>$55B</td></tr>
<tr><td>ACLP max LTV</td><td>100%</td></tr>
</tbody></table>
</div>
</div>
</div>

<!-- Saved panel -->
<div class="content-panel" id="panel-saved">
<div class="saved-panel">
<h2>Saved Responses</h2>
<div id="saved-list">
<div class="saved-empty">
<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
<p>No saved responses yet</p>
<p style="font-size:11px;margin-top:8px">Bookmark helpful answers to find them quickly</p>
</div>
</div>
</div>
</div>
</div>
</div>

<script>
const API_BASE='https://hardwood-input-patterns-guitar.trycloudflare.com';
let token=sessionStorage.getItem('cmhc_token');
let chatHistory=[];
let savedItems=JSON.parse(localStorage.getItem('cmhc_saved')||'[]');
let isStreaming=false;

// Time display
function updateTime(){const d=new Date();document.getElementById('top-time').textContent=d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true})}
updateTime();setInterval(updateTime,30000);

// Auth check
if(token){showApp()}

// Login
document.getElementById('login-form').addEventListener('submit',async e=>{
e.preventDefault();
const btn=document.getElementById('login-btn');
const pw=document.getElementById('login-password').value;
if(!pw)return;
btn.disabled=true;btn.textContent='Verifying...';
try{
const r=await fetch(API_BASE+'/api/auth',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:pw})});
const d=await r.json();
if(d.ok){token=d.token;sessionStorage.setItem('cmhc_token',token);document.getElementById('login-screen').classList.add('hidden');setTimeout(showApp,800)}
else{document.getElementById('login-error').textContent='Invalid access code';btn.disabled=false;btn.textContent='Sign In'}
}catch(err){document.getElementById('login-error').textContent='Connection error';btn.disabled=false;btn.textContent='Sign In'}
});

function showApp(){
document.getElementById('login-screen').classList.add('hidden');
document.getElementById('app').classList.add('active');
loadChat();animateCounters();
}

// Nav
function switchPanel(name){
document.querySelectorAll('.nav-item').forEach(n=>n.classList.toggle('active',n.dataset.panel===name));
document.querySelectorAll('.content-panel').forEach(p=>p.classList.toggle('active',p.id==='panel-'+name));
if(name==='saved')renderSaved();
}
function toggleNav(){document.getElementById('nav-sidebar').classList.toggle('expanded')}

// Counter animation
function animateCounters(){
document.querySelectorAll('.stat-card-value').forEach(el=>{
const target=parseInt(el.dataset.target);
const prefix=el.dataset.prefix||'';
const suffix=el.dataset.suffix||'';
let current=0;
const step=Math.max(1,Math.floor(target/30));
const interval=setInterval(()=>{
current=Math.min(current+step,target);
el.textContent=prefix+current+suffix;
if(current>=target)clearInterval(interval);
},40);
});
}

// Keyboard shortcut
document.addEventListener('keydown',e=>{if((e.metaKey||e.ctrlKey)&&e.key==='k'){e.preventDefault();document.getElementById('chat-input').focus()}});

// Chat input
const chatInput=document.getElementById('chat-input');
chatInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage()}});

// Suggestions
const suggestQueries=['What are the eligibility criteria for CMHC multi unit mortgage insurance?','Explain the premium rate structure and LTV tiers for MLI','What is the ACLP program and how does it work?','Explain the LTV and DSC ratio requirements','What is MLI Select and what benefits does it offer?','What changed in Advice 263 and 264?'];
function askSuggestion(el){
const idx=[...el.parentElement.children].indexOf(el);
chatInput.value=suggestQueries[idx]||el.querySelector('.suggest-card-title').textContent;
sendMessage();
}

// Send message
async function sendMessage(){
const text=chatInput.value.trim();
if(!text||isStreaming)return;
chatInput.value='';

document.getElementById('welcome').style.display='none';
const msgContainer=document.getElementById('messages');
msgContainer.style.display='flex';

// Add user msg
addMessage('user',text);
chatHistory.push({role:'user',content:text});
saveChat();

// Stream bot response
isStreaming=true;
document.getElementById('progress-bar').classList.add('loading');
const botEl=addMessage('bot','');
const bodyEl=botEl.querySelector('.msg-card-body');

try{
const r=await fetch(API_BASE+'/api/chat',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({message:text,history:chatHistory.slice(-20)})});
if(r.status===401){sessionStorage.removeItem('cmhc_token');location.reload();return}
const reader=r.body.getReader();
const decoder=new TextDecoder();
let full='';let buf='';
while(true){
const{done,value}=await reader.read();
if(done)break;
buf+=decoder.decode(value,{stream:true});
const lines=buf.split('\n');
buf=lines.pop();
for(const line of lines){
if(line.startsWith('data: ')){
const d=line.slice(6);
if(d==='[DONE]')continue;
try{const j=JSON.parse(d);if(j.content){full+=j.content;bodyEl.innerHTML=renderMarkdown(full);scrollChat()}}catch(e){}
}}
}
chatHistory.push({role:'assistant',content:full});
botEl.dataset.content=full;
botEl.dataset.question=text;
saveChat();
}catch(err){bodyEl.innerHTML='<p style="color:#ef4444">Connection error. Please try again.</p>'}
isStreaming=false;
document.getElementById('progress-bar').classList.remove('loading');
}

function addMessage(role,content){
const msgContainer=document.getElementById('messages');
const div=document.createElement('div');
div.className='msg '+role;
if(role==='user'){
div.innerHTML='<div class="msg-label">You</div><div class="msg-content">'+escapeHtml(content)+'</div>';
}else{
div.innerHTML=`<div class="msg-card"><div class="msg-card-bar"></div><div class="msg-card-body">${content?renderMarkdown(content):''}</div><div class="msg-toolbar"><button onclick="copyMsg(this)" title="Copy"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> Copy</button><button onclick="bookmarkMsg(this)" title="Bookmark"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg> Save</button></div></div>`;
}
msgContainer.appendChild(div);
scrollChat();
return div;
}

function scrollChat(){const a=document.getElementById('chat-area');a.scrollTop=a.scrollHeight}

// Markdown renderer (simple)
function renderMarkdown(text){
let html=text
.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
// Tables
.replace(/^(\|.+\|)\n(\|[\s\-:|]+\|)\n((?:\|.+\|\n?)*)/gm,(_,header,sep,body)=>{
const ths=header.split('|').filter(c=>c.trim()).map(c=>'<th>'+c.trim()+'</th>').join('');
const rows=body.trim().split('\n').map(row=>{
const tds=row.split('|').filter(c=>c.trim()).map(c=>{
let v=c.trim();
// Highlight numbers in mono
v=v.replace(/(\$[\d,.]+[BMK]?|[\d,.]+%|[\d,.]+)/g,'<span class="mono">$1</span>');
return '<td>'+v+'</td>';
}).join('');
return '<tr>'+tds+'</tr>';
}).join('');
return '<table><thead><tr>'+ths+'</tr></thead><tbody>'+rows+'</tbody></table>';
})
// Headers
.replace(/^### (.+)$/gm,'<h3>$1</h3>')
.replace(/^## (.+)$/gm,'<h2>$1</h2>')
.replace(/^# (.+)$/gm,'<h1>$1</h1>')
// Bold/italic
.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
.replace(/\*(.+?)\*/g,'<em>$1</em>')
// Code
.replace(/`(.+?)`/g,'<code>$1</code>')
// Links
.replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" target="_blank">$1</a>')
// Lists
.replace(/^[-*] (.+)$/gm,'<li>$1</li>')
.replace(/((?:<li>.+<\/li>\n?)+)/g,'<ul>$1</ul>')
// Numbered lists
.replace(/^\d+\. (.+)$/gm,'<li>$1</li>')
// Paragraphs
.replace(/\n{2,}/g,'</p><p>')
// Line breaks
.replace(/\n/g,'<br>');
// Highlight numbers in running text
html=html.replace(/(?<![<\w\/"#=])(\$[\d,.]+[BMK]?(?:\s?(?:billion|million))?)/g,'<span class="mono">$1</span>');
return '<p>'+html+'</p>';
}

function escapeHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

// Copy
function copyMsg(btn){
const card=btn.closest('.msg');
const text=card.dataset.content||card.querySelector('.msg-card-body').textContent;
navigator.clipboard.writeText(text);
btn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Copied';
btn.classList.add('active');
setTimeout(()=>{btn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg> Copy';btn.classList.remove('active')},2000);
}

// Bookmark
function bookmarkMsg(btn){
const msg=btn.closest('.msg');
const content=msg.dataset.content||msg.querySelector('.msg-card-body').textContent;
const question=msg.dataset.question||'';
const item={id:Date.now(),question,preview:content.substring(0,200),content,time:new Date().toISOString()};
savedItems.unshift(item);
localStorage.setItem('cmhc_saved',JSON.stringify(savedItems));
btn.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="var(--gold)" stroke="var(--gold)" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg> Saved';
btn.classList.add('active');
}

// Saved panel
function renderSaved(){
const list=document.getElementById('saved-list');
if(!savedItems.length){list.innerHTML='<div class="saved-empty"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg><p>No saved responses yet</p><p style="font-size:11px;margin-top:8px">Bookmark helpful answers to find them quickly</p></div>';return}
list.innerHTML=savedItems.map((s,i)=>'<div class="saved-item"><button class="saved-remove" onclick="removeSaved('+i+',event)">&times;</button><div class="q">'+escapeHtml(s.question)+'</div><div class="preview">'+escapeHtml(s.preview)+'</div><div class="time">'+new Date(s.time).toLocaleDateString()+'</div></div>').join('');
}
function removeSaved(i,e){e.stopPropagation();savedItems.splice(i,1);localStorage.setItem('cmhc_saved',JSON.stringify(savedItems));renderSaved()}

// Chat persistence
function saveChat(){localStorage.setItem('cmhc_chat',JSON.stringify(chatHistory))}
function loadChat(){
const data=JSON.parse(localStorage.getItem('cmhc_chat')||'[]');
if(!data.length)return;
chatHistory=data;
document.getElementById('welcome').style.display='none';
const mc=document.getElementById('messages');mc.style.display='flex';
for(let i=0;i<data.length;i++){
const m=data[i];
if(m.role==='user'){addMessage('user',m.content)}
else if(m.role==='assistant'){
const el=addMessage('bot',m.content);
el.dataset.content=m.content;
if(i>0&&data[i-1].role==='user')el.dataset.question=data[i-1].content;
}
}
}
</script>
</body>
</html>